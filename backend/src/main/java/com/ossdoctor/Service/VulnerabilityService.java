package com.ossdoctor.Service;

import com.ossdoctor.DTO.VulnerabilityDTO;
import com.ossdoctor.Entity.VulnerabilityEntity;
import com.ossdoctor.Repository.RepositoryRepository;
import com.ossdoctor.Repository.VulnerabilityRepository;
import lombok.AllArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@AllArgsConstructor
public class VulnerabilityService {

    private VulnerabilityRepository vulnerabilityRepository;
    private RepositoryRepository repositoryRepository;

    private VulnerabilityDTO save(VulnerabilityDTO vulnerabilityDTO) {
        return toDTO(vulnerabilityRepository.save(toEntity(vulnerabilityDTO)));
    }

    private VulnerabilityDTO toDTO(VulnerabilityEntity entity) {
        return VulnerabilityDTO.builder()
                .idx(entity.getIdx())
                .repositoryId(entity.getRepository().getIdx())
                .severity(entity.getSeverity())
                .description(entity.getDescription())
                .detectedAt(entity.getDetectedAt())
                .fixedAt(entity.getFixedAt())
                .build();
    }

    private VulnerabilityEntity toEntity(VulnerabilityDTO dto) {
        return VulnerabilityEntity.builder()
                .repository(repositoryRepository.findById(dto.getRepositoryId()).get())
                .severity(dto.getSeverity())
                .description(dto.getDescription())
                .detectedAt(dto.getDetectedAt())
                .fixedAt(dto.getFixedAt())
                .build();
    }
}
